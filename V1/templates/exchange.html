{%- extends "base.html" -%}

{%- block title -%}Exchange{%- endblock -%}

{%- set active_page = 'exchange' -%}

{%- block content -%}
<div style="display: flex; height: calc(100vh - 60px);">
        <div style="flex: 0 0 320px; background-color: var(--bg-secondary); border-right: 1px solid var(--border-color); overflow-y: auto;">
            <div class="sidebar-header">
                <h3 class="sidebar-title">üìÅ Saved Profiles</h3>
            </div>
            
            <div style="padding: 1rem;">
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All</button>
                    <button class="filter-tab" data-filter="data">üìä Data</button>
                    <button class="filter-tab" data-filter="trading">üíπ Trading</button>
                </div>
                
                <div id="profiles-container" style="margin-top: 1rem;">
                    <!-- Profiles will be loaded here -->
                </div>
            </div>
        </div>
        
        <div style="flex: 1; display: flex; flex-direction: column;">
            <div style="flex: 1; overflow-y: auto; padding: 2rem;">
                <div class="add-profile-section">
                    <h2 style="margin-bottom: 1.5rem;">‚ûï Add New Profile</h2>
                    
                    <div class="card" style="max-width: 800px;">
                        <div class="card-header">
                            <h3 class="card-title">BASIC INFORMATION</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Profile Name</label>
                                <input type="text" id="profile-name" class="form-control" placeholder="e.g. Binance Main, MT5 Demo">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Exchange</label>
                                <select id="exchange-select" class="form-control">
                                    <option value="">-- Select Exchange --</option>
                                    <option value="DNSE">DNSE</option>
                                    <option value="ENTRADE">Entrade</option>
                                    <option value="ENTRADE-MQTT">Entrade MQTT</option>
                                    <option value="MT5">MetaTrader 5</option>
                                    <option value="BINANCE">Binance</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card" style="max-width: 800px; margin-top: 1.5rem;">
                        <div class="card-header">
                            <h3 class="card-title">üéØ PROFILE USAGE</h3>
                            <p style="margin: 0; color: var(--text-muted); font-size: 0.875rem;">Ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng profile n√†y trong Connection modal</p>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; gap: 2rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="use-for-data">
                                    <span>üìä Use for Market Data</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="use-for-trading">
                                    <span>üíπ Use for Trading</span>
                                </label>
                            </div>
                            <p style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-muted);">
                                Profile n√†y s·∫Ω hi·ªán trong dropdown "Data Profile" ƒë·ªÉ load chart<br>
                                (C·∫ßn Trading Token cho DNSE)
                            </p>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem; max-width: 800px;">
                        <button id="test-connection-btn" class="btn btn-secondary">üîå Test Connection</button>
                        <button id="save-profile-btn" class="btn btn-primary" style="flex: 1;">üíæ Save Profile</button>
                    </div>
                </div>
            </div>
            
            <div style="flex: 0 0 300px; background-color: #000000; border-top: 1px solid var(--border-color);">
                <div style="padding: 1rem;">
                    <h3 style="color: #00ff00; margin-bottom: 1rem; font-family: 'Courier New', monospace;">üíª Connection Terminal</h3>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <button class="btn btn-sm btn-secondary terminal-clear">Clear</button>
                        <button class="btn btn-sm btn-primary">Export</button>
                    </div>
                </div>
                <div class="terminal">
                    <div class="terminal-line terminal-output">[system] Terminal ready. Waiting for connection events...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h5><i class="fas fa-edit"></i> <span id="modalTitle">Editing profile: DNSE</span></h5>
                <button class="close-btn" onclick="Exchange.closeEditModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: calc(90vh - 200px); overflow-y: auto;">
                <!-- BASIC INFORMATION -->
                <div class="form-section">
                    <h6 class="section-title">BASIC INFORMATION</h6>
                    
                    <div class="form-group">
                        <label class="form-label">Profile Name</label>
                        <input type="text" id="edit-profile-name" class="form-control" placeholder="DNSE">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Exchange</label>
                        <select id="edit-exchange" class="form-control">
                            <option value="DNSE">DNSE</option>
                            <option value="ENTRADE">Entrade</option>
                            <option value="ENTRADE-MQTT">Entrade MQTT</option>
                            <option value="MT5">MetaTrader 5</option>
                            <option value="BINANCE">Binance</option>
                        </select>
                    </div>
                </div>
                
                <!-- DNSE CREDENTIALS -->
                <div class="form-section" id="dnseCredentials">
                    <h6 class="section-title">DNSE CREDENTIALS (C√ì PHI·∫æU + PH√ÅI SINH)</h6>
                    
                    <div class="form-group">
                        <label class="form-label">Protocol</label>
                        <select id="edit-protocol" class="form-control">
                            <option value="rest-api">REST API (Trading + Email OTP)</option>
                            <option value="websocket">WebSocket</option>
                            <option value="mqtt">MQTT</option>
                        </select>
                        <small class="form-text">REST API cho t·∫•t l·ªánh, MQTT cho realtime, Public cho historical data (kh√¥ng c·∫ßn credentials)</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="edit-username" class="form-control" placeholder="0919990840">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="edit-password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="edit-otp-required" checked>
                            <span>üîí Y√™u c·∫ßu x√°c th·ª±c OTP khi k·∫øt n·ªëi (Email OTP)</span>
                        </label>
                        <small class="form-text">N·∫øu b·∫≠t, s·∫Ω hi·ªán modal nh·∫≠p OTP khi b·∫•m "Test Connection"</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tickers (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)</label>
                        <input type="text" id="edit-tickers" class="form-control" placeholder="VD: VN30F1M,VNM,FPT,VCB">
                        <small class="form-text">Danh s√°ch ticker s·∫Ω hi·ªÉn th·ªã khi ch·ªçn profile</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Timeframe m·∫∑c ƒë·ªãnh</label>
                        <select id="edit-timeframe" class="form-control">
                            <option value="1m" selected>1 Minute (M1)</option>
                            <option value="5m">5 Minutes (M5)</option>
                            <option value="15m">15 Minutes (M15)</option>
                            <option value="30m">30 Minutes (M30)</option>
                            <option value="1h">1 Hour (H1)</option>
                            <option value="4h">4 Hours (H4)</option>
                            <option value="1d">1 Day (D1)</option>
                        </select>
                        <small class="form-text">Timeframe s·∫Ω t·ª± ƒë·ªông ƒë∆∞·ª£c ch·ªçn khi k·∫øt n·ªëi</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">S·ªë n·∫øn hi·ªÉn th·ªã</label>
                        <input type="number" id="edit-candle-count" class="form-control" value="1000" min="100" max="10000">
                        <small class="form-text">S·ªë l∆∞·ª£ng n·∫øn t·ªëi ƒëa ƒë∆∞·ª£c ch·ªçn khi k·∫øt n·ªëi</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Timezone (GMT Offset)</label>
                        <select id="edit-timezone" class="form-control">
                            <option value="-12">GMT-12</option>
                            <option value="-11">GMT-11</option>
                            <option value="-10">GMT-10</option>
                            <option value="-9">GMT-9</option>
                            <option value="-8">GMT-8</option>
                            <option value="-7">GMT-7</option>
                            <option value="-6">GMT-6</option>
                            <option value="-5">GMT-5</option>
                            <option value="-4">GMT-4</option>
                            <option value="-3">GMT-3</option>
                            <option value="-2">GMT-2</option>
                            <option value="-1">GMT-1</option>
                            <option value="0">GMT+0</option>
                            <option value="1">GMT+1</option>
                            <option value="2">GMT+2</option>
                            <option value="3">GMT+3</option>
                            <option value="4">GMT+4</option>
                            <option value="5">GMT+5</option>
                            <option value="6">GMT+6</option>
                            <option value="7" selected>GMT+7 (Vietnam, Thailand)</option>
                            <option value="8">GMT+8</option>
                            <option value="9">GMT+9</option>
                            <option value="10">GMT+10</option>
                            <option value="11">GMT+11</option>
                            <option value="12">GMT+12</option>
                        </select>
                        <small class="form-text">ƒêi·ªÅu ch·ªânh m√∫i gi·ªù hi·ªÉn th·ªã tr√™n chart (GMT+7 cho Vi·ªát Nam)</small>
                    </div>
                </div>
                
                <!-- PROFILE USAGE -->
                <div class="form-section">
                    <h6 class="section-title">üîå PROFILE USAGE</h6>
                    <p class="section-description">Ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng profile n√†y trong Connection modal</p>
                    
                    <div class="usage-options">
                        <label class="usage-option">
                            <input type="checkbox" id="edit-use-market-data">
                            <span>üìä Use for Market Data</span>
                            <p class="option-description">Profile n√†y s·∫Ω hi·ªán trong dropdown "Data Profile" ƒë·ªÉ load chart</p>
                        </label>
                        
                        <label class="usage-option">
                            <input type="checkbox" id="edit-use-trading" checked>
                            <span>üíπ Use for Trading</span>
                            <p class="option-description">Profile n√†y s·∫Ω hi·ªán trong dropdown "Trading Profile" ƒë·ªÉ ƒë·∫∑t l·ªánh <span style="color: #f59e0b;">(C·∫ßn Trading Token cho DNSE)</span></p>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="Exchange.testConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <button class="btn btn-primary" onclick="Exchange.updateProfile()">
                    <i class="fas fa-save"></i> Update Profile
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add New Profile Button (Floating) -->
    <button id="addNewProfileBtn" class="floating-add-btn" onclick="Exchange.openAddNewModal()">
        <i class="fas fa-plus"></i> Add New
    </button>
{%- endblock -%}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/exchange.js') }}"></script>
{% endblock %}
