<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Strategy Builder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .strategy-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .strategy-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-new { background: #4caf50; color: white; }
        .btn-save { background: #2962ff; color: white; }
        .btn-load { background: #ff9800; color: white; }
        .btn-auto { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        
        .panel-tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #2a2e39;
            margin-bottom: 20px;
        }
        .panel-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #787b86;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .panel-tab.active {
            color: #2962ff;
            border-bottom: 2px solid #2962ff;
        }
        
        .panel-content {
            background: #131722;
            padding: 20px;
            border-radius: 8px;
        }
        .panel-content.hidden {
            display: none;
        }
        
        .entry-direction-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .entry-direction-tab {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }
        .entry-direction-tab.active {
            background: #2962ff;
            color: white;
        }
        
        .entry-direction-content.hidden {
            display: none;
        }
        
        .btn-add {
            background: #26a69a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            background: #1e222d;
            border: 1px solid #2a2e39;
            border-radius: 4px;
            color: #d1d4dc;
            margin-bottom: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #131722;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #d1d4dc;
        }
        .modal-footer {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-primary {
            flex: 1;
            padding: 12px;
            background: #2962ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: #2a2e39;
            color: #d1d4dc;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body style="background: #131722; color: #d1d4dc; font-family: Arial, sans-serif; margin: 0;">
    <div class="strategy-container">
        <h1 style="margin-bottom: 20px;">ðŸ“Š Strategy Builder</h1>
        
        <!-- Actions -->
        <div class="strategy-actions">
            <button class="btn-action btn-new" onclick="newStrategy()">âž• New</button>
            <button class="btn-action btn-save" onclick="saveStrategy()">ðŸ’¾ Save</button>
            <button class="btn-action btn-load" onclick="loadStrategy()">ðŸ“‚ Load</button>
            <button class="btn-action btn-auto" onclick="openAutoGenerateModal()">ðŸ¤– Auto Generate</button>
        </div>
        
        <!-- Strategy Info -->
        <div style="margin-bottom: 20px;">
            <input type="text" id="strategyName" class="form-input" placeholder="Strategy Name" value="My Strategy">
            <textarea id="strategyDescription" class="form-input" placeholder="Description" rows="2"></textarea>
        </div>
        
        <!-- Tabs -->
        <div class="panel-tabs">
            <button class="panel-tab active" onclick="switchPanel('entry')">Entry</button>
            <button class="panel-tab" onclick="switchPanel('exit')">Exit</button>
            <button class="panel-tab" onclick="switchPanel('indicators')">Indicators</button>
            <button class="panel-tab" onclick="switchPanel('engine')">Trading Engine</button>
        </div>
        
        <!-- Entry Panel -->
        <div class="panel-content" id="entryPanel">
            <div class="entry-direction-tabs">
                <button class="entry-direction-tab active" id="longEntryTab" onclick="switchEntryDirection('long')">ðŸ“ˆ Long Entry</button>
                <button class="entry-direction-tab" id="shortEntryTab" onclick="switchEntryDirection('short')">ðŸ“‰ Short Entry</button>
            </div>
            
            <div class="entry-direction-content" id="longEntryContent">
                <h3>Long Entry Conditions</h3>
                <div id="longConditions"></div>
                <button class="btn-add" onclick="addCondition('long')">+ Add Long Condition</button>
            </div>
            
            <div class="entry-direction-content hidden" id="shortEntryContent">
                <h3>Short Entry Conditions</h3>
                <div id="shortConditions"></div>
                <button class="btn-add" onclick="addCondition('short')">+ Add Short Condition</button>
            </div>
        </div>
        
        <!-- Exit Panel -->
        <div class="panel-content hidden" id="exitPanel">
            <div class="entry-direction-tabs">
                <button class="entry-direction-tab active" id="longExitTab" onclick="switchExitDirection('long')">ðŸ“ˆ Long Exit</button>
                <button class="entry-direction-tab" id="shortExitTab" onclick="switchExitDirection('short')">ðŸ“‰ Short Exit</button>
            </div>
            
            <div class="entry-direction-content" id="longExitContent">
                <h3>Long Exit Rules</h3>
                <label>Take Profit (points):</label>
                <input type="number" id="tpBuyPoints" class="form-input" value="10">
                <label>Stop Loss (points):</label>
                <input type="number" id="stopLossPoints" class="form-input" value="20">
                <label>Trailing (points):</label>
                <input type="number" id="fixedTrailingBuyPoints" class="form-input" value="5">
                <label>Time Exit:</label>
                <input type="time" id="exitTimeLong" class="form-input" value="14:30">
            </div>
            
            <div class="entry-direction-content hidden" id="shortExitContent">
                <h3>Short Exit Rules</h3>
                <label>Take Profit (points):</label>
                <input type="number" id="tpShortPoints" class="form-input" value="10">
                <label>Stop Loss (points):</label>
                <input type="number" id="slShortPoints" class="form-input" value="20">
                <label>Trailing (points):</label>
                <input type="number" id="fixedTrailingShortPoints" class="form-input" value="5">
                <label>Time Exit:</label>
                <input type="time" id="exitTimeShort" class="form-input" value="14:30">
            </div>
        </div>
        
        <!-- Indicators Panel -->
        <div class="panel-content hidden" id="indicatorsPanel">
            <h3>Indicators</h3>
            <p style="color: #787b86;">Indicators are managed in the Indicators tab (already implemented)</p>
        </div>
        
        <!-- Trading Engine Panel -->
        <div class="panel-content hidden" id="enginePanel">
            <h3>Trading Engine</h3>
            
            <h4>Entry Price Type:</h4>
            <label><input type="radio" name="entryPriceType" value="O"> Open</label><br>
            <label><input type="radio" name="entryPriceType" value="H"> High</label><br>
            <label><input type="radio" name="entryPriceType" value="L"> Low</label><br>
            <label><input type="radio" name="entryPriceType" value="C" checked> Close</label><br><br>
            
            <h4>Entry After Candle:</h4>
            <label><input type="checkbox" id="entryAfter1" checked> After 1 candle</label><br>
            <label><input type="checkbox" id="entryAfter2"> After 2 candles</label><br><br>
            
            <h4>Position Mode:</h4>
            <label><input type="radio" name="positionMode" value="long_only" checked> Long Only</label><br>
            <label><input type="radio" name="positionMode" value="short_only"> Short Only</label><br>
            <label><input type="radio" name="positionMode" value="long_and_short"> Long & Short</label>
        </div>
    </div>
    
    <!-- Auto Generate Modal -->
    <div class="modal" id="autoGenerateModal">
        <div class="modal-content">
            <div class="modal-header">ðŸ¤– Auto Generate Strategy</div>
            
            <label>Long Signals:</label>
            <input type="number" id="autoGenLongSignals" class="form-input" value="2" min="1" max="10">
            
            <label>Short Signals:</label>
            <input type="number" id="autoGenShortSignals" class="form-input" value="2" min="1" max="10">
            
            <label>Indicators per Signal:</label>
            <input type="number" id="autoGenIndicatorsPerSignal" class="form-input" value="2" min="1" max="5">
            
            <label>Profit Levels:</label>
            <input type="number" id="autoGenProfitLevels" class="form-input" value="4" min="2" max="10">
            
            <label>Profit Step:</label>
            <input type="number" id="autoGenProfitStep" class="form-input" value="3" min="1" max="10">
            
            <label><input type="checkbox" id="autoGenKeepIndicators" checked> Keep Current Indicators</label><br>
            <label><input type="checkbox" id="autoGenRandomizeTPSL" checked> Randomize TP/SL</label>
            
            <div class="modal-footer">
                <button class="btn-primary" onclick="generateStrategy()">âœ¨ Generate</button>
                <button class="btn-secondary" onclick="closeAutoGenerateModal()">Cancel</button>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/strategy-builder.js') }}"></script>
</body>
</html>
