# âœ… HOÃ€N THÃ€NH: V5 STRATEGY BUILDER + RESAMPLE

## ğŸ“¦ Ná»˜I DUNG ÄÃƒ THá»°C HIá»†N:

### 1. â­ STRATEGY STRUCTURE (JSON)
**File:** `/strategies/strategy_template.json`

```json
{
  "name": "Strategy Name",
  "description": "...",
  "indicators": [...],
  "entry_conditions": {
    "long": [{conditions: [...]}],
    "short": [{conditions: [...]}]
  },
  "exit_rules": {
    "long": {tp_points, sl_points, trailing, tp_sl_table},
    "short": {...}
  },
  "trading_engine": {
    "entry_price_type": "C",
    "entry_after_candle": [1],
    "position_mode": "long_only"
  },
  "risk_management": {...}
}
```

**4 TAB STRATEGY:**
- âœ… Tab 1: ENTRY (Long/Short entry conditions)
- âœ… Tab 2: EXIT (TP/SL/Trailing + Time exit)
- âœ… Tab 3: INDICATOR (Danh sÃ¡ch indicators - Ä‘Ã£ cÃ³ sáºµn)
- âœ… Tab 4: TRADING ENGINE (Entry type, Position mode, Exit methods)

---

### 2. ğŸ¤– AUTO GENERATOR (Backend)
**File:** `/trading_engine/auto_generator.py`

**Class:** `StrategyAutoGenerator`

**Method chÃ­nh:** 
```python
modify_strategy(
    current_strategy,
    long_signals=2,        # Sá»‘ signal Long
    short_signals=2,       # Sá»‘ signal Short
    indicators_per_signal=2,  # Sá»‘ chá»‰ bÃ¡o/signal
    profit_levels=4,       # Sá»‘ level TP/SL
    profit_step=3,         # BÆ°á»›c tÄƒng profit
    keep_indicators=True,  # Giá»¯ indicators hiá»‡n táº¡i
    randomize_tpsl=True    # Random TP/SL values
)
```

**Logic:**
1. Giá»¯ hoáº·c thÃªm indicators (náº¿u thiáº¿u)
2. Generate random entry conditions (cross_above, >, <, ...)
3. Generate TP/SL table vá»›i profit ranges
4. Return strategy má»›i

---

### 3. ğŸ“¡ BACKEND APIs

#### A. `/api/auto-generate-strategy` (POST)
```javascript
POST /api/auto-generate-strategy
{
  current_strategy: {...},
  long_signals: 2,
  short_signals: 2,
  indicators_per_signal: 2,
  profit_levels: 4,
  profit_step: 3,
  keep_indicators: true,
  randomize_tpsl: true
}

Response:
{
  success: true,
  strategy: {...}
}
```

#### B. `/api/strategies` (GET/POST)
- GET: List all strategies
- POST: Save strategy

#### C. `/api/strategies/<filename>` (GET/DELETE)
- GET: Load strategy
- DELETE: Delete strategy

#### D. `/api/resample-data` (POST) - ÄÃƒ CÃ“
- Resample CSV offline data

#### E. `/api/connect-exchange` (POST) - ÄÃƒ CÃ“
- Connect exchange vÃ  láº¥y data online

---

### 4. ğŸ”§ RESAMPLE CHO 3 CHART

**Files cáº§n update:** (Xem file CHART_UPDATE_GUIDE.txt)
- `/static/js/chart-manual.js`
- `/static/js/chart-bot.js`
- `/static/js/chart-strategy.js`

**Thay Ä‘á»•i:**
- âŒ XÃ“A hÃ m `resampleBars()` (khÃ´ng cáº§n ná»¯a)
- âœ… THAY `const resampledBars = this.resampleBars(...)` 
- âœ… Báº°NG `const resampledBars = rawBars` (backend Ä‘Ã£ xá»­ lÃ½)

**LÃ½ do:**
- Data offline: Backend resample qua `/api/resample-data`
- Data online: Exchange tráº£ Ä‘Ãºng timeframe

---

## ğŸ“ Cáº¤U TRÃšC Dá»° ÃN Má»šI:

```
v5-data/
â”œâ”€â”€ app.py                          # âœ… Updated (thÃªm 4 APIs)
â”œâ”€â”€ requirements.txt
â”‚
â”œâ”€â”€ strategies/                     # â­ NEW
â”‚   â””â”€â”€ strategy_template.json     # Template JSON
â”‚
â”œâ”€â”€ trading_engine/                 # â­ NEW
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ auto_generator.py           # Auto generate strategies
â”‚
â”œâ”€â”€ utils/                          # âœ… ÄÃƒ CÃ“ (tá»« láº§n trÆ°á»›c)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ timeframe_resampler.py
â”‚
â”œâ”€â”€ exchanges/                      # âœ… ÄÃƒ CÃ“ (Ä‘Ã£ update)
â”‚   â”œâ”€â”€ dnse_client.py              # + get_historical_data()
â”‚   â””â”€â”€ entrade_client.py           # + get_historical_data()
â”‚
â”œâ”€â”€ static/js/
â”‚   â”œâ”€â”€ chart-manual.js             # âš ï¸ Cáº¦N UPDATE (xÃ³a resample)
â”‚   â”œâ”€â”€ chart-bot.js                # âš ï¸ Cáº¦N UPDATE (xÃ³a resample)
â”‚   â””â”€â”€ chart-strategy.js           # âš ï¸ Cáº¦N UPDATE (xÃ³a resample)
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ manual-trading.html
â”‚   â”œâ”€â”€ bot-trading.html
â”‚   â””â”€â”€ strategy.html
â”‚
â””â”€â”€ CHART_UPDATE_GUIDE.txt          # HÆ°á»›ng dáº«n update chart
```

---

## ğŸ¯ CÃCH Sá»¬ Dá»¤NG

### Frontend - Auto Generate Strategy:
```javascript
// 1. Gá»i API auto-generate
const response = await fetch('/api/auto-generate-strategy', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        current_strategy: currentStrategy,
        long_signals: 2,
        short_signals: 2,
        indicators_per_signal: 2,
        profit_levels: 4,
        profit_step: 3,
        keep_indicators: true,
        randomize_tpsl: true
    })
});

const result = await response.json();

// 2. Apply strategy
if (result.success) {
    strategyConfig = result.strategy;
    renderUI(); // Update táº¥t cáº£ 4 tabs
}
```

### Frontend - Save/Load Strategy:
```javascript
// Save
await fetch('/api/strategies', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(strategy)
});

// Load
const response = await fetch('/api/strategies/My_Strategy.json');
const data = await response.json();
const strategy = data.strategy;

// List all
const response = await fetch('/api/strategies');
const data = await response.json();
const strategies = data.strategies; // [{filename, name, description}]
```

---

## ğŸš€ TRIá»‚N KHAI TIáº¾P

### BÆ°á»›c 1: Update 3 file chart JS
LÃ m theo hÆ°á»›ng dáº«n trong `CHART_UPDATE_GUIDE.txt`:
- XÃ³a hÃ m resampleBars() 
- Thay Ä‘á»•i call resampleBars()

### BÆ°á»›c 2: Frontend - Strategy Builder UI
Táº¡o 4 tabs:
1. **Entry Tab**: Add/edit long/short conditions
2. **Exit Tab**: Configure TP/SL/Trailing
3. **Indicator Tab**: ÄÃ£ cÃ³ sáºµn
4. **Trading Engine Tab**: Entry type, position mode

### BÆ°á»›c 3: Test
```bash
# Cháº¡y server
python app.py

# Test API
curl -X POST http://localhost:5000/api/auto-generate-strategy \
  -H "Content-Type: application/json" \
  -d '{
    "current_strategy": {...},
    "long_signals": 2,
    "short_signals": 2
  }'
```

---

## ğŸ“Š LÆ¯á»¢C Äá»’ HOáº T Äá»˜NG

```
USER INTERFACE (4 Tabs)
    â†“
Tab 1: Entry â†’ Add conditions manually OR click "Auto" button
    â†“
"Auto" button â†’ Call /api/auto-generate-strategy
    â†“
Backend: StrategyAutoGenerator.modify_strategy()
    â†“
    - Keep/Add indicators
    - Generate random entry conditions
    - Generate TP/SL table
    â†“
Response: Modified strategy JSON
    â†“
Frontend: Apply to UI â†’ Render all 4 tabs
    â†“
User click "Save" â†’ /api/strategies (POST)
    â†“
Backend: Save to /strategies/My_Strategy.json
```

---

## âœ… CHECKLIST

**Backend:**
- [x] Cáº¥u trÃºc JSON strategy
- [x] Auto generator module
- [x] API auto-generate-strategy
- [x] API strategies (CRUD)
- [x] API resample-data (tá»« láº§n trÆ°á»›c)
- [x] API connect-exchange (tá»« láº§n trÆ°á»›c)

**Frontend:**
- [ ] Update 3 chart JS files (xÃ³a resample)
- [ ] Táº¡o 4 tabs UI (Entry, Exit, Indicator, Engine)
- [ ] Auto generate modal
- [ ] Save/Load strategy UI
- [ ] Integrate vá»›i chart

**Testing:**
- [ ] Test auto-generate API
- [ ] Test save/load strategy
- [ ] Test resample cho 3 charts
- [ ] Test full workflow

---

**File ZIP:** V5-Data-Load-Updated.zip (152KB)
**NgÃ y:** 18/11/2025
